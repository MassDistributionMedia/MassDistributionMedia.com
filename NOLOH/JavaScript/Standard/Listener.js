function _NListener(c,f,e,b){this.ParentId=c;this.Id=f;this.Transport=e;this.Interval=b;this.Enabled=true;var d=_N(c);do{if(d.NonControls==null){d.NonControls=[]}d.NonControls.push(f);d=d.parentNode}while(d&&d.id);_N[f]=this;this.Start();var a;if(_N.Listeners==null){_N.Listeners={}}if(_N.Listeners[e]==null){a=_N.Listeners[e]=new _NListenerBundle(f,e)}else{a=_N.Listeners[e];a.Stop();a.Ids.push(f)}if(!a.Starting){setTimeout(function(){a.Start();a.Starting=null},500);a.Starting=true}}_NListener.prototype.Start=function(){this.Started=true};_NListener.prototype.Stop=function(){this.Started=false};_NListener.prototype.Destroy=function(){var b,c=_N(this.ParentId),a=_N.Listeners[this.Transport];a.Stop();do{if(c.NonControls!=null){for(b=0;b<c.NonControls.length;++b){if(c.NonControls[b]==this.Id){c.NonControls.splice(b,1)}}}c=c.parentNode}while(c&&c.id);var e=a.Ids,d=e.length;for(b=0;b<d;++b){if(e[b]==this.Id){e.splice(b,1)}}this.ParentId=null;if(e.length==0){delete _N.Listeners[this.Transport]}};function _NListenerBundle(b,a){this.Ids=[b];this.Transport=a}_NListenerBundle.prototype.Start=function(){this.Stop();this.Offset=0;var f=this,b=location.href,d="",h,c,e,g,a;for(c=0,e=this.Ids.length;c<e;++c){if((g=_N(h=this.Ids[c]))&&g.ParentId&&g.Started&&g.Enabled){d+=h+",";if(a==null||a>g.Interval){a=g.Interval}}}if(d){d=d.substring(0,d.length-1);this.Request=_NXHR("POST",b.indexOf("#/")==-1?b.replace(location.hash,""):b.replace("#/",b.indexOf("?")==-1?"?":"&"),function(){_NListenerReqStateChange.call(f)},true);this.Request.send("_NVisit="+ ++_N.Visit+"&_NApp="+_NApp+"&_NListener="+d);if(this.Transport=="Stream"){this.Timer=setInterval(function(){_NListenerStream.call(f)},a)}}};_NListenerBundle.prototype.Stop=function(){if(this.Request){this.AbortSwitch=true;this.Request.abort();this.AbortSwitch=null;if(this.Timer){clearInterval(this.Timer)}this.Request=null}};function _NListenerReqStateChange(){if(this.Request.readyState==4&&this.Request.status==200){if(this.Timer){clearInterval(this.Timer)}var b=this.Transport=="Poll";if(b){_NProcessResponse(this.Request.responseText)}else{_NListenerStream.call(this)}this.Request=null;if(this.Transport!="Stream"&&!this.AbortSwitch){if(this.Transport=="LongPoll"){this.Start()}else{if(b){var a=this;setTimeout(function(){a.Start()},interval)}}}}}function _NListenerStream(){if(this.Request.readyState>=3){var a=this.Request.responseText,b=a.lastIndexOf("/*_N2*/");if(b>this.Offset){_NProcessResponse(a.substring(this.Offset,b));this.Offset=b}}}function _NListenersHold(){var a=_N.Listeners,b;for(b in a){a[b].Stop()}}function _NListenersCont(){var a=_N.Listeners,b;for(b in a){a[b].Start()}};